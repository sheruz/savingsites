!function(a){var b={init:function(c){return this.each(function(){var d=a.extend({},a.fn.stepy.defaults,c),e=a(this).data("options",d),f=e.attr("id");void 0!==f&&""!=f||(f="stepy-"+a("."+e.attr("class")).index(this),e.attr("id",f));var g=a("<ul/>",{id:f+"-titles",class:"stepy-titles"});d.titleTarget?a(d.titleTarget).html(g):g.insertBefore(e),d.validate&&(jQuery.validator.setDefaults({ignore:d.ignore}),e.append('<div class="stepy-error"/>'));var h=e.children("fieldset"),i=void 0,j=void 0,k="",l="";h.each(function(c){i=a(this),i.addClass("step").attr("id",f+"-step-"+c).append('<p id="'+f+"-buttons-"+c+'" class="'+f+'-buttons"/>'),j=i.children("legend"),d.legend||j.hide(),k="",d.description&&(j.length?k="<span>"+j.html()+"</span>":a.error(f+": the legend element of the step "+(c+1)+" is required to set the description!")),l=i.attr("title"),l=""!=l?"<div>"+l+"</div>":"--",g.append('<li id="'+f+"-title-"+c+'">'+l+k+"</li>"),0==c?h.length>1&&b.createNextButton.call(e,c):(b.createBackButton.call(e,c),i.hide(),c<h.length-1&&b.createNextButton.call(e,c))});var m=g.children();m.first().addClass("current-step");var n=e.children(".finish");if(d.finishButton)if(n.length){var o=e.is("form"),p=void 0;d.finish&&o&&(p=e.attr("onsubmit"),e.attr("onsubmit","return false;")),n.click(function(a){if(d.finish&&!b.execute.call(e,d.finish,h.length-1))a.preventDefault();else if(o){p?e.attr("onsubmit",p):e.removeAttr("onsubmit");var c="submit"==n.attr("type");c||d.validate&&!b.validate.call(e,h.length-1)||e.submit()}}),n.appendTo(e.find("p:last"))}else a.error(f+': element with class name "finish" missing!');d.titleClick?m.click(function(){var c=m.filter(".current-step").attr("id").split("-"),f=parseInt(c[c.length-1],10),g=a(this).index();if(g>f){if(d.next&&!b.execute.call(e,d.next,g))return!1}else if(g<f&&d.back&&!b.execute.call(e,d.back,g))return!1;g!=f&&b.step.call(e,g+1)}):m.css("cursor","default"),h.delegate('input[type="text"], input[type="password"]',"keypress",function(b){if(13==(b.keyCode?b.keyCode:b.which)){b.preventDefault();var d=a(this).parent().children("."+f+"-buttons");if(d.length){var e=d.children(".button-next");if(e.length)e.click();else{var g=d.children(".finish");g.length&&g.click()}}}}),h.first().find(":input:visible:enabled").first().select().focus()})},createBackButton:function(c){var d=this,e=this.attr("id"),f=this.data("options");a("<a/>",{id:e+"-back-"+c,href:"javascript:void(0);",class:"button-back",html:f.backLabel}).click(function(){f.back&&!b.execute.call(d,f.back,c-1)||b.step.call(d,c-1+1)}).appendTo(a("#"+e+"-buttons-"+c))},createNextButton:function(c){var d=this,e=this.attr("id"),f=this.data("options");a("<a/>",{id:e+"-next-"+c,href:"javascript:void(0);",class:"button-next",html:f.nextLabel}).click(function(){f.next&&!b.execute.call(d,f.next,c+1)||b.step.call(d,c+1+1)}).appendTo(a("#"+e+"-buttons-"+c))},execute:function(a,b){var c=a.call(this,b+1);return c||void 0===c},step:function(c){c--;var d=this.children("fieldset");c>d.length-1&&(c=d.length-1);var e=this.data("options");if(max=c,e.validate)for(var f=!0,g=0;g<c;g++)if(f&=b.validate.call(this,g),e.block&&!f){max=g;break}if(d.hide().eq(max).show(),a("#"+this.attr("id")+"-titles").children().removeClass("current-step").eq(max).addClass("current-step"),this.is("form")){var i=void 0;i=max==c?d.eq(max).find(":input:enabled:visible"):d.eq(max).find(".error").select().focus(),i.first().select().focus()}return e.select&&e.select.call(this,max+1),this},validate:function(b){if(!this.is("form"))return!0;var c=this.children("fieldset").eq(b),d=!0,e=a("#"+this.attr("id")+"-titles").children().eq(b),f=this.data("options"),g=this.validate();return a(c.find(":input:enabled").get().reverse()).each(function(){var b=g.element(a(this));void 0===b&&(b=!0),d&=b,d?f.errorImage&&e.removeClass("error-image"):(f.errorImage&&e.addClass("error-image"),g.focusInvalid())}),d}};a.fn.stepy=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist!"):b.init.apply(this,arguments)},a.fn.stepy.defaults={back:void 0,backLabel:"&lt; Back",block:!1,description:!0,errorImage:!1,finish:void 0,finishButton:!0,legend:!0,ignore:"",next:void 0,nextLabel:"Next &gt;",titleClick:!1,titleTarget:void 0,validate:!1,select:void 0}}(jQuery);